# -*- coding: utf-8 -*-
# @Time    : 2022/11/5 16:35
# @Author  : codewen77

# 13类
acos_res_category = ['RESTAURANT#GENERAL', 'SERVICE#GENERAL', 'FOOD#GENERAL', 'FOOD#QUALITY', 'FOOD#STYLE_OPTIONS',
                     'DRINKS#STYLE_OPTIONS', 'DRINKS#PRICES', 'AMBIENCE#GENERAL', 'RESTAURANT#PRICES', 'FOOD#PRICES',
                     'RESTAURANT#MISCELLANEOUS', 'DRINKS#QUALITY', 'LOCATION#GENERAL']
# 122类
acos_laptop_category = ['MULTIMEDIA_DEVICES#PRICE', 'OS#QUALITY', 'SHIPPING#QUALITY', 'GRAPHICS#OPERATION_PERFORMANCE',
                        'CPU#OPERATION_PERFORMANCE',
                        'COMPANY#DESIGN_FEATURES', 'MEMORY#OPERATION_PERFORMANCE', 'SHIPPING#PRICE',
                        'POWER_SUPPLY#CONNECTIVITY', 'SOFTWARE#USABILITY',
                        'FANS&COOLING#GENERAL', 'GRAPHICS#DESIGN_FEATURES', 'BATTERY#GENERAL', 'HARD_DISC#USABILITY',
                        'FANS&COOLING#DESIGN_FEATURES',
                        'MEMORY#DESIGN_FEATURES', 'MOUSE#USABILITY', 'CPU#GENERAL', 'LAPTOP#QUALITY',
                        'POWER_SUPPLY#GENERAL', 'PORTS#QUALITY',
                        'KEYBOARD#PORTABILITY', 'SUPPORT#DESIGN_FEATURES', 'MULTIMEDIA_DEVICES#USABILITY',
                        'MOUSE#GENERAL', 'KEYBOARD#MISCELLANEOUS',
                        'MULTIMEDIA_DEVICES#DESIGN_FEATURES', 'OS#MISCELLANEOUS', 'LAPTOP#MISCELLANEOUS',
                        'SOFTWARE#PRICE', 'FANS&COOLING#OPERATION_PERFORMANCE',
                        'MEMORY#QUALITY', 'OPTICAL_DRIVES#OPERATION_PERFORMA  NCE', 'HARD_DISC#GENERAL',
                        'MEMORY#GENERAL', 'DISPLAY#OPERATION_PERFORMANCE',
                        'MULTIMEDIA_DEVICES#GENERAL', 'LAPTOP#GENERAL', 'MOTHERBOARD#QUALITY', 'LAPTOP#PORTABILITY',
                        'KEYBOARD#PRICE', 'SUPPORT#OPERATION_PERFORMANCE',
                        'GRAPHICS#GENERAL', 'MOTHERBOARD#OPERATION_PERFORMANCE', 'DISPLAY#GENERAL', 'BATTERY#QUALITY',
                        'LAPTOP#USABILITY', 'LAPTOP#DESIGN_FEATURES',
                        'PORTS#CONNECTIVITY', 'HARDWARE#QUALITY', 'SUPPORT#GENERAL', 'MOTHERBOARD#GENERAL',
                        'PORTS#USABILITY', 'KEYBOARD#QUALITY', 'GRAPHICS#USABILITY',
                        'HARD_DISC#PRICE', 'OPTICAL_DRIVES#USABILITY', 'MULTIMEDIA_DEVICES#CONNECTIVITY',
                        'HARDWARE#DESIGN_FEATURES', 'MEMORY#USABILITY',
                        'SHIPPING#GENERAL', 'CPU#PRICE', 'Out_Of_Scope#DESIGN_FEATURES', 'MULTIMEDIA_DEVICES#QUALITY',
                        'OS#PRICE', 'SUPPORT#QUALITY',
                        'OPTICAL_DRIVES#GENERAL', 'HARDWARE#USABILITY', 'DISPLAY#DESIGN_FEATURES', 'PORTS#GENERAL',
                        'COMPANY#OPERATION_PERFORMANCE',
                        'COMPANY#GENERAL', 'Out_Of_Scope#GENERAL', 'KEYBOARD#DESIGN_FEATURES',
                        'Out_Of_Scope#OPERATION_PERFORMANCE',
                        'OPTICAL_DRIVES#DESIGN_FEATURES', 'LAPTOP#OPERATION_PERFORMANCE', 'KEYBOARD#USABILITY',
                        'DISPLAY#USABILITY', 'POWER_SUPPLY#QUALITY',
                        'HARD_DISC#DESIGN_FEATURES', 'DISPLAY#QUALITY', 'MOUSE#DESIGN_FEATURES', 'COMPANY#QUALITY',
                        'HARDWARE#GENERAL', 'COMPANY#PRICE',
                        'MULTIMEDIA_DEVICES#OPERATION_PERFORMANCE', 'KEYBOARD#OPERATION_PERFORMANCE',
                        'SOFTWARE#PORTABILITY', 'HARD_DISC#OPERATION_PERFORMANCE',
                        'BATTERY#DESIGN_FEATURES', 'CPU#QUALITY', 'WARRANTY#GENERAL', 'OS#DESIGN_FEATURES',
                        'OS#OPERATION_PERFORMANCE', 'OS#USABILITY',
                        'SOFTWARE#GENERAL', 'SUPPORT#PRICE', 'SHIPPING#OPERATION_PERFORMANCE', 'DISPLAY#PRICE',
                        'LAPTOP#PRICE', 'OS#GENERAL', 'HARDWARE#PRICE',
                        'SOFTWARE#DESIGN_FEATURES', 'HARD_DISC#MISCELLANEOUS', 'PORTS#PORTABILITY',
                        'FANS&COOLING#QUALITY', 'BATTERY#OPERATION_PERFORMANCE',
                        'CPU#DESIGN_FEATURES', 'PORTS#OPERATION_PERFORMANCE', 'SOFTWARE#OPERATION_PERFORMANCE',
                        'KEYBOARD#GENERAL', 'SOFTWARE#QUALITY',
                        'LAPTOP#CONNECTIVITY', 'POWER_SUPPLY#DESIGN_FEATURES', 'HARDWARE#OPERATION_PERFORMANCE',
                        'WARRANTY#QUALITY', 'HARD_DISC#QUALITY',
                        'POWER_SUPPLY#OPERATION_PERFORMANCE', 'PORTS#DESIGN_FEATURES', 'Out_Of_Scope#USABILITY',
                        'OPTICAL_DRIVES#OPERATION_PERFORMANCE']

# 13类
asqe_category = ['整体', '使用体验', '功效', '价格', '物流', '气味', '包装', '真伪', '服务', '其他', '成分', '尺寸',
                 '新鲜度']

# 13类
quad_category = ['RESTAURANT#GENERAL', 'SERVICE#GENERAL', 'FOOD#GENERAL', 'FOOD#QUALITY', 'FOOD#STYLE_OPTIONS',
                 'DRINKS#STYLE_OPTIONS', 'DRINKS#PRICES', 'AMBIENCE#GENERAL', 'RESTAURANT#PRICES', 'FOOD#PRICES',
                 'RESTAURANT#MISCELLANEOUS', 'DRINKS#QUALITY', 'LOCATION#GENERAL']

# 138类
zh_quad_category = ['食品饮料-功效#心脑血管', '食品饮料-功效#调节肠胃', '食品饮料-功效#调理体质',
                    '通用-买家态度#忠诚度', '通用-买家态度#复购/流失倾向', '通用-使用#舒适性', '通用-卖家#发货',
                    '食品饮料-味道#综合味道', '通用-买家态度#竞品对比', '通用-价格#价格', '食品饮料-功效#塑形',
                    '食品饮料-功效#美容', '食品饮料-功效#血液/血糖', '食品饮料-功效#智力发育', '通用-物流#物流速度',
                    '通用-产品质量#品质', '食品饮料-成分#营养成分', '通用-物流#物流态度', '通用-感官#异味',
                    '食品饮料-溶解性#挂壁/沉淀', '通用-卖家#商家/客服态度', '食品饮料-健康#新鲜度', '通用-包装#密封性',
                    '食品饮料-味道#口味风味', '通用-产品质量#正品', '食品饮料-功效#肝肾护理', '食品饮料-成分#添加剂',
                    '食品饮料-成分#成分种类', '食品饮料-功效#体重和肌肉', '食品饮料-营养#营养',
                    '食品饮料-不良反应#其他不适', '通用-买家态度#值得推荐', '通用-包装#包装美观',
                    '食品饮料-健康#低脂/零脂肪', '通用-卖家#购物平台', '通用-买家态度#描述对比', '通用-促销#赠品',
                    '通用-促销#活动', '食品饮料-成分#产地来源', '通用-使用#设计', '食品饮料-味道#甜味',
                    '通用-感官#大小', '食品饮料-不良反应#拉肚子/胀气', '通用-品牌实力#品牌', '食品饮料-饱腹感#解馋',
                    '通用-产品质量#生产日期', '食品饮料-口感#综合口感', '食品饮料-口感#温度',
                    '食品饮料-配套配件#配套配件', '食品饮料-味道#辣味', '通用-包装#包装设计', '通用-物流#物流其他',
                    '通用-使用#受众群体', '通用-感官#颜色', '食品饮料-味道#奶香味', '食品饮料-溶解性#结块',
                    '食品饮料-功效#解渴/解腻/解暑', '食品饮料-功效#助眠', '食品饮料-功效#呼吸系统', '通用-感官#材质',
                    '食品饮料-味道#苦味/苦涩味', '食品饮料-健康#低糖/无糖', '食品饮料-饱腹感#饱腹感',
                    '通用-产地来源#国产', '食品饮料-不良反应#上火', '食品饮料-产品规格#分量/容量', '通用-包装#包装方式',
                    '食品饮料-健康#健康', '通用-买家态度#购物意愿', '通用-感官#外观', '通用-感官#款式',
                    '通用-物流#配送便捷', '通用-买家态度#购物体验', '通用-卖家#库存', '食品饮料-口感#浓稠度/浓郁度',
                    '食品饮料-气味#香味', '食品饮料-口感#Q弹', '食品饮料-口感#爽度', '食品饮料-口感#软绵度',
                    '通用-包装#包装规格', '通用-价格#性价比', '食品饮料-功效#明目', '食品饮料-气味#异味',
                    '食品饮料-健康#干净/卫生', '通用-感官#手感', '通用-产品质量#洁净度', '食品饮料-溶解性#溶解',
                    '食品饮料-气味#滋气味', '通用-卖家#专业性', '食品饮料-味道#酸味', '食品饮料-口感#紧实度/嚼劲',
                    '食品饮料-功效#骨骼', '食品饮料-口感#余味/回味', '食品饮料-成分#食品成分',
                    '食品饮料-功效#补充人体元素', '食品饮料-功效#预防病症', '食品饮料-气味#其他怪味',
                    '食品饮料-口感#脆度', '通用-卖家#响应', '食品饮料-口感#颗粒感', '食品饮料-气味#综合气味',
                    '通用-使用#使用场景', '食品饮料-功效#提神/醒脑', '通用-物流#物流丢失缺损', '通用-退换货#退换货',
                    '食品饮料-口感#油腻', '食品饮料-不良反应#反胃/呕吐/不消化', '食品饮料-气味#咖啡香',
                    '食品饮料-口感#滑度', '通用-品牌实力#广告', '食品饮料-功效#脾健康', '食品饮料-口感#细腻度',
                    '食品饮料-气味#腥味/奶腥味', '食品饮料-味道#鲜味', '食品饮料-气味#谷物味', '食品饮料-功效#抗氧化',
                    '通用-物流#运费', '通用-使用#使用方便/简单', '食品饮料-口感#其他特殊口感', '食品饮料-不良反应#过敏',
                    '通用-包装#包装材料', '食品饮料-功效#记忆力提升', '食品饮料-功效#补充能量', '通用-产品质量#发票',
                    '通用-产品质量#标签', '食品饮料-健康#有机', '通用-卖家#品类齐全', '食品饮料-味道#咸味',
                    '食品饮料-营养#吸收', '通用-感官#香味', '食品饮料-功效#清新口气', '食品饮料-口感#丰富度/层次感',
                    '通用-使用#便携性', '食品饮料-气味#果香', '通用-使用#说明书/教程', '通用-包装#包装环保',
                    '通用-使用#功能', '食品饮料-口感#涩感']

chinese_sentiment = ["负面", "中性", "正面"]
english_sentiment = ['negative', 'neutral', 'positive']


def getJsonl(data_path):
    """
    从jsonl文件获取数据
    :param data_path: train dev test jsonl数据存放路径
    :return:
    """
    with open(data_path, 'r', encoding='utf-8') as fp:
        lines = fp.readlines()

    data_list = []
    # count = 0
    for line in lines:
        line = eval(line)
        # if len(line['sentence']) > 200:
        #     count += 1
        #     continue
        data_list.append(line)
    return data_list


# aspect类别
def get_aspect_category(task: str, data_type: str):
    if task.lower() == 'asqe':
        categorys = asqe_category
    elif task.lower() == 'acos':
        if data_type == 'laptop':
            categorys = acos_laptop_category
        else:
            categorys = acos_res_category
    elif task.lower() == 'zh_quad':  # quad
        categorys = zh_quad_category
    else:
        categorys = quad_category

    category2id = {c: i for i, c in enumerate(categorys)}
    id2category = {i: c for i, c in enumerate(categorys)}
    return [categorys] + [category2id] + [id2category]


# 情感极性
def get_sentiment(task):
    if task.lower() == 'asqe' or task.lower() == 'zh_quad':
        sentiment = chinese_sentiment
    else:
        # 消极的 中性的 积极的
        sentiment = english_sentiment
    sentiment2id = {s: i for i, s in enumerate(sentiment)}
    id2sentiment = {i: s for i, s in enumerate(sentiment)}
    return [sentiment] + [sentiment2id] + [id2sentiment]


def get_category_sentiment_num_list(args):
    task, data_type, data_path = args.task, args.data_type, args.data_path
    data_path += 'train.jsonl'
    if task.lower() == 'asqe':
        categorys = asqe_category
    elif task.lower() == 'acos':
        if data_type == 'laptop':
            categorys = acos_laptop_category
        else:
            categorys = acos_res_category
    elif task.lower() == 'zh_quad':  # quad
        categorys = zh_quad_category
    else:
        categorys = quad_category

    if task.lower() == 'asqe' or task.lower() == 'zh_quad':
        sentiment = chinese_sentiment
    else:
        # 消极的 中性的 积极的
        sentiment = english_sentiment

    category_dict = {i: 0 for i in categorys}
    sentiment_dict = {i: 0 for i in sentiment}
    data_list = getJsonl(data_path)
    count = 0
    for d in data_list:
        labels = d['labels']
        for label in labels:
            cate, senti = label[1], label[-1]
            category_dict[cate] += 1
            sentiment_dict[senti] += 1
            count += 1

    category_num_list, sentiment_num_list = [0 for _ in range(len(category_dict))], [0 for _ in
                                                                                     range(len(sentiment_dict))]
    for i, key in enumerate(category_dict):
        category_num_list[i] = category_dict[key]
    for i, key in enumerate(sentiment_dict):
        sentiment_num_list[i] = sentiment_dict[key]
    return [category_num_list, sentiment_num_list]
